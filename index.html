<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Calendario Semanal — Agencia IA</title>
  <style>
    :root{
      --bg:#0b0b0f;          /* fondo negro profundo */
      --ink:#F5F7FA;         /* texto blanco suave */
      --muted:#9aa4ad;
      --grid:#1b1f2a;        /* líneas sutiles */
      --card:#12131a;
      --accent:#42f5b9;
      --radius:16px;
      --shadow:0 10px 30px rgba(0,0,0,.45);

      /* Gradientes neón */
      --grad-work: linear-gradient(135deg,#ff3d7f,#ff9a44);
      --grad-gym:  linear-gradient(135deg,#00E2FF,#00FFA3);
      --grad-free: linear-gradient(135deg,#8A64FF,#00E5FF);
      --grad-study:linear-gradient(135deg,#FFC857,#FF3CAC);
      --grad-sleep:linear-gradient(135deg,#4b5bff,#1e1e6a);
      --grad-meal: linear-gradient(135deg,#FFE53B,#FF2525);
      --grad-clean:linear-gradient(135deg,#7CF4FF,#38BDF8);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:var(--bg);color:var(--ink);font:15px/1.4 system-ui,Segoe UI,Roboto,Inter,sans-serif}

    /* Login */
    #gate{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:radial-gradient(60% 60% at 50% 40%,#11121a 0%,#0b0b0f 60%,#0b0b0f 100%);z-index:99}
    .card{background:var(--card);padding:28px;border-radius:var(--radius);box-shadow:var(--shadow);width:min(420px,92vw);border:1px solid #202437}
    .title{font-weight:700;font-size:20px;margin:0 0 8px}
    .sub{margin:0 0 18px;color:var(--muted)}
    .row{display:flex;gap:10px}
    input[type=password]{flex:1;background:#0e1118;border:1px solid #24283b;color:var(--ink);border-radius:12px;padding:12px}
    .btn{border:0;padding:12px 14px;border-radius:14px;color:#0a0a0a;font-weight:700;cursor:pointer;box-shadow:0 0 24px rgba(66,245,185,.35), inset 0 0 1px rgba(255,255,255,.4);}
    .btn-neon{background:linear-gradient(135deg,#00FFA3,#00E2FF)}
    .hint{margin-top:10px;color:#ea6a6a;min-height:18px}

    /* App Shell */
    header{display:flex;align-items:center;justify-content:space-between;gap:14px;padding:16px 18px;background:#0d0f16;border-bottom:1px solid #1d2233;position:sticky;top:0;z-index:3}
    .stack{display:flex;gap:10px;flex-wrap:wrap}
    .chip{padding:9px 12px;border-radius:999px;background:#111422;border:1px solid #20283f;color:var(--ink)}

    /* Botones rápidos (neón) */
    .quick{display:flex;gap:10px;flex-wrap:wrap}
    .qbtn{border:0;padding:10px 12px;border-radius:14px;color:#0a0a0a;font-weight:700;cursor:pointer;box-shadow:0 0 22px rgba(0,0,0,.25)}
    .qbtn span{filter:drop-shadow(0 0 8px rgba(255,255,255,.15))}
    .q-work{background:var(--grad-work)}
    .q-gym{background:var(--grad-gym)}
    .q-free{background:var(--grad-free)}
    .q-study{background:var(--grad-study)}
    .q-sleep{background:var(--grad-sleep);color:#cfd8ff}
    .q-meal{background:var(--grad-meal)}
    .q-clean{background:var(--grad-clean)}

    main{padding:16px;display:grid;gap:16px}

    /* Calendario */
    .grid-wrap{background:var(--card);border-radius:18px;border:1px solid #1e2436;box-shadow:var(--shadow);overflow:hidden}
    .calendar{display:grid;grid-template-columns:80px repeat(7,1fr);}
    .cal-head{display:contents}
    .cal-head div{padding:12px 10px;border-bottom:1px solid #252a3e;background:#101423}
    .cal-head .h{font-weight:700}
    .cal-head .muted{color:#94a3b8;font-weight:600}

    .times{display:grid;grid-auto-rows:56px}
    .times div{padding:6px 8px;border-top:1px dashed #23283b;color:#6b7280}

    .cols{display:grid;grid-template-columns:repeat(7,1fr)}
    .col{display:grid;grid-auto-rows:56px;border-left:1px solid #1d2233}
    .cell{border-top:1px solid #141928;position:relative}

    /* Contenedor de eventos en grid absoluto */
    .events{display:grid;grid-template-columns:repeat(7,1fr);grid-auto-rows:56px;position:relative}

    .event{position:relative;border-radius:12px;padding:8px 10px;margin:4px;color:#0c0c0c;font-weight:700;user-select:none;border:1px solid rgba(255,255,255,.15);box-shadow:0 10px 22px rgba(0,0,0,.35);display:flex;align-items:center;justify-content:space-between;gap:8px}
    .event .label{background:rgba(255,255,255,.15);padding:2px 8px;border-radius:999px;color:#111}
    .event small{font-weight:600;color:#111}
    .event .title{color:#0a0a0a}
    .event[data-type="work"] {background:var(--grad-work)}
    .event[data-type="gym"]  {background:var(--grad-gym)}
    .event[data-type="free"] {background:var(--grad-free)}
    .event[data-type="study"]{background:var(--grad-study)}
    .event[data-type="sleep"]{background:var(--grad-sleep)}
    .event[data-type="meal"] {background:var(--grad-meal)}
    .event[data-type="clean"]{background:var(--grad-clean)}

    .toolbar{display:flex;gap:10px;flex-wrap:wrap}
    .ghost{opacity:.6;outline:2px dashed #3b82f6}

    /* Modal */
    dialog{border:1px solid #2a3045;border-radius:18px;background:#0e1118;color:var(--ink);box-shadow:var(--shadow);width:min(520px,92vw)}
    dialog::backdrop{background:rgba(0,0,0,.55)}
    .modal-head{display:flex;justify-content:space-between;align-items:center;padding-bottom:6px;border-bottom:1px solid #20263a;margin-bottom:12px}
    .modal-actions{display:flex;justify-content:flex-end;gap:10px;margin-top:14px}
    .select, .text, .number, .time{width:100%;padding:10px;border-radius:12px;border:1px solid #23283b;background:#0b0e15;color:var(--ink)}
    .row2{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .btn-ghost{background:#121524;color:#d1d5db;border:1px solid #2a3148;border-radius:14px;padding:10px 12px}
    .btn-danger{background:#ff6b6b;color:#0a0a0a;border:0;padding:10px 12px;border-radius:14px;font-weight:700}

    footer{padding:12px 16px;color:#94a3b8}
    a{color:#86efac}
    .sr{position:absolute;left:-9999px}
  </style>
</head>
<body>
  <!-- Gate -->
  <section id="gate" aria-labelledby="gtitle">
    <div class="card">
      <h1 id="gtitle" class="title">Calendario semanal — Acceso</h1>
      <p class="sub">Introduce la contraseña para entrar.</p>
      <div class="row">
        <input id="pwd" type="password" placeholder="Contraseña" autocomplete="current-password" />
        <button id="enter" class="btn btn-neon">Entrar</button>
      </div>
      <div id="hint" class="hint" aria-live="polite"></div>
      <p class="sub" style="margin-top:12px">Consejo: se guarda automáticamente en este navegador.</p>
    </div>
  </section>

  <!-- App -->
  <header>
    <div class="stack">
      <div class="chip">Calendario — Dueño Agencia IA</div>
      <div class="chip" id="weekLabel">Semana actual</div>
    </div>
    <div class="toolbar">
      <button class="qbtn q-work" data-quick="work"><span>+ Trabajo/Reunión IA</span></button>
      <button class="qbtn q-gym"  data-quick="gym"><span>+ Gimnasio</span></button>
      <button class="qbtn q-study"data-quick="study"><span>+ Estudio</span></button>
      <button class="qbtn q-meal" data-quick="meal"><span>+ Meal Prep</span></button>
      <button class="qbtn q-clean"data-quick="clean"><span>+ Organización</span></button>
      <button class="qbtn q-free" data-quick="free"><span>+ Tiempo Libre</span></button>
      <button class="qbtn q-sleep"data-quick="sleep"><span>+ Sueño</span></button>
    </div>
  </header>

  <main>
    <section class="grid-wrap" aria-label="Calendario semanal">
      <div class="calendar">
        <div class="cal-head">
          <div class="muted">Hora</div>
          <div class="h">Lunes</div>
          <div class="h">Martes</div>
          <div class="h">Miércoles</div>
          <div class="h">Jueves</div>
          <div class="h">Viernes</div>
          <div class="h">Sábado</div>
          <div class="h">Domingo</div>
        </div>
        <div class="times" id="times"></div>
        <div class="cols" id="cols"></div>
      </div>
      <div class="events" id="events" aria-live="polite"></div>
    </section>

    <section class="stack">
      <button id="export" class="btn btn-neon">Exportar JSON</button>
      <button id="clear" class="btn-ghost">Limpiar semana</button>
    </section>
  </main>

  <dialog id="editor">
    <form method="dialog" id="form">
      <div class="modal-head">
        <strong>Nuevo / Editar bloque</strong>
        <button id="closeModal" class="btn-ghost" value="cancel">Cerrar</button>
      </div>
      <div class="row2" style="margin-bottom:10px">
        <select class="select" id="type">
          <option value="work">Trabajo / Reunión IA</option>
          <option value="gym">Gimnasio</option>
          <option value="study">Estudio</option>
          <option value="sleep">Sueño</option>
          <option value="meal">Meal prep</option>
          <option value="clean">Organización / limpieza</option>
          <option value="free">Tiempo libre</option>
        </select>
        <input class="text" id="titleInput" placeholder="Título (opcional)" />
      </div>
      <div class="row2">
        <select class="select" id="day">
          <option value="0">Lunes</option>
          <option value="1">Martes</option>
          <option value="2">Miércoles</option>
          <option value="3">Jueves</option>
          <option value="4">Viernes</option>
          <option value="5">Sábado</option>
          <option value="6">Domingo</option>
        </select>
        <input class="time" id="start" type="time" value="09:00" step="3600" />
      </div>
      <div class="row2">
        <label class="sr" for="dur">Duración</label>
        <input class="number" id="dur" type="number" min="1" max="8" value="1" />
        <div style="display:flex;align-items:center;color:#aab1c2">horas</div>
      </div>
      <div class="modal-actions">
        <button id="del" class="btn-danger" type="button" hidden>Eliminar</button>
        <button id="save" class="btn btn-neon" value="default">Guardar</button>
      </div>
    </form>
  </dialog>

  <footer>
    Atajos: clic en una celda para crear, arrastra un bloque para moverlo, doble clic para editar.
  </footer>

  <script>
    /******************** LOGIN SIMPLE ********************/
    const PASSWORD = "Bunyola20";
    const gate = document.getElementById('gate');
    const hint = document.getElementById('hint');
    const enterBtn = document.getElementById('enter');
    const pwdInput = document.getElementById('pwd');

    function unlock(){
      if(pwdInput.value === PASSWORD){
        sessionStorage.setItem('calendar_ok','1');
        gate.style.display='none';
      } else {
        hint.textContent = 'Contraseña incorrecta';
      }
    }
    enterBtn.addEventListener('click',unlock);
    pwdInput.addEventListener('keydown',e=>{ if(e.key==='Enter'){ unlock(); }});
    if(sessionStorage.getItem('calendar_ok')==='1'){ gate.style.display='none'; }

    /******************** CALENDARIO ********************/
    const startHour = 6;  // 06:00
    const endHour   = 23; // 23:00
    const times = document.getElementById('times');
    const cols  = document.getElementById('cols');
    const eventsGrid = document.getElementById('events');
    const weekLabel = document.getElementById('weekLabel');

    // Generar horas y columnas
    for(let h=startHour; h<=endHour; h++){
      const t = document.createElement('div');
      t.textContent = String(h).padStart(2,'0') + ':00';
      times.appendChild(t);
    }
    for(let d=0; d<7; d++){
      const col = document.createElement('div');
      col.className='col';
      for(let h=startHour; h<=endHour; h++){
        const cell = document.createElement('div');
        cell.className='cell';
        cell.dataset.day=d;
        cell.dataset.hour=h;
        cell.title = `Clic para añadir en ${['Lun','Mar','Mié','Jue','Vie','Sáb','Dom'][d]} ${String(h).padStart(2,'0')}:00`;
        cell.addEventListener('click',()=>openEditor({day:d,start:h+':00',dur:1}));
        col.appendChild(cell);
      }
      cols.appendChild(col);
    }

    // Semana label
    const now = new Date();
    const onejan = new Date(now.getFullYear(),0,1);
    const week = Math.ceil((((now - onejan) / 86400000) + onejan.getDay()+1) / 7);
    weekLabel.textContent = `Semana ${week} · ${now.getFullYear()}`;

    /******************** DATOS ********************/
    const KEY='calendar_events_v1';
    let EVENTS = JSON.parse(localStorage.getItem(KEY) || '[]');

    function save(){ localStorage.setItem(KEY, JSON.stringify(EVENTS)); }

    function toGridRow(hh){ return (parseInt(hh,10) - startHour) + 1; } // +1 porque grid inicia en 1

    function render(){
      eventsGrid.innerHTML='';
      // asegurar el alto de filas
      eventsGrid.style.gridAutoRows='56px';
      for(const ev of EVENTS){
        const el = document.createElement('div');
        el.className='event';
        el.draggable=true;
        el.dataset.id=ev.id;
        el.dataset.type=ev.type;
        el.style.gridColumn = (ev.day+1); // 1..7
        el.style.gridRow = `${toGridRow(ev.start.split(':')[0])} / span ${ev.dur}`;
        el.innerHTML = `<div class="title">${ev.title || labelFor(ev.type)}</div><small>${pad(ev.start)} · ${ev.dur}h</small>`;
        el.addEventListener('dblclick',()=>openEditor(ev));
        enableDrag(el);
        eventsGrid.appendChild(el);
      }
    }

    function pad(t){ return /^\d{1}:/.test(t)?'0'+t:t; }

    function labelFor(type){
      return {
        work:'Trabajo', gym:'Gimnasio', free:'Tiempo libre', study:'Estudio', sleep:'Sueño', meal:'Meal prep', clean:'Organización'
      }[type] || 'Evento';
    }

    /******************** EDITOR ********************/
    const editor = document.getElementById('editor');
    const typeSel = document.getElementById('type');
    const daySel  = document.getElementById('day');
    const startInp= document.getElementById('start');
    const durInp  = document.getElementById('dur');
    const titleInp= document.getElementById('titleInput');
    const delBtn  = document.getElementById('del');

    let currentId = null;

    function openEditor(base){
      currentId = base.id || null;
      typeSel.value = base.type || 'work';
      daySel.value  = base.day  ?? 0;
      startInp.value= base.start || '09:00';
      durInp.value  = base.dur   || 1;
      titleInp.value= base.title || '';
      delBtn.hidden = !base.id;
      editor.showModal();
    }

    document.getElementById('form').addEventListener('submit', (e)=>{
      e.preventDefault();
      const data = {
        id: currentId || crypto.randomUUID(),
        type: typeSel.value,
        day: Number(daySel.value),
        start: startInp.value.substring(0,2)+':00',
        dur: Math.max(1, Math.min(8, Number(durInp.value))),
        title: titleInp.value.trim()
      };
      const idx = EVENTS.findIndex(x=>x.id===data.id);
      if(idx>=0) EVENTS[idx]=data; else EVENTS.push(data);
      save();
      render();
      editor.close();
    });

    delBtn.addEventListener('click',()=>{
      if(!currentId) return;
      EVENTS = EVENTS.filter(x=>x.id!==currentId);
      save();
      render();
      editor.close();
    });

    document.getElementById('closeModal').addEventListener('click',()=>editor.close());

    /******************** DRAG & DROP ********************/
    function enableDrag(el){
      el.addEventListener('dragstart', (e)=>{
        e.dataTransfer.setData('text/plain', el.dataset.id);
        el.classList.add('ghost');
      });
      el.addEventListener('dragend', (e)=>{
        el.classList.remove('ghost');
      });
    }

    // Permite soltar sobre toda la rejilla
    eventsGrid.addEventListener('dragover', (e)=>{ e.preventDefault(); });
    eventsGrid.addEventListener('drop', (e)=>{
      e.preventDefault();
      const id = e.dataTransfer.getData('text/plain');
      const rect = eventsGrid.getBoundingClientRect();
      const x = e.clientX - rect.left;
      const y = e.clientY - rect.top;
      const colW = rect.width / 7;
      const rowH = 56; // fijo
      let day = Math.min(6, Math.max(0, Math.floor(x / colW)));
      let row = Math.min(endHour-startHour, Math.max(0, Math.floor(y / rowH)));
      const hour = startHour + row;
      const idx = EVENTS.findIndex(ev=>ev.id===id);
      if(idx>=0){
        EVENTS[idx].day = day;
        EVENTS[idx].start = String(hour).padStart(2,'0')+':00';
        save();
        render();
      }
    });

    /******************** BOTONES RÁPIDOS ********************/
    document.querySelectorAll('[data-quick]').forEach(btn=>{
      btn.addEventListener('click',()=>{
        const type = btn.dataset.quick;
        openEditor({type, day:new Date().getDay()-1, start:'09:00', dur:(type==='sleep'?8:1), title:''});
      });
    });

    /******************** EXPORT & CLEAR ********************/
    document.getElementById('export').addEventListener('click',()=>{
      const data = JSON.stringify(EVENTS, null, 2);
      const blob = new Blob([data], {type:'application/json'});
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = 'calendario-semanal.json';
      a.click();
      URL.revokeObjectURL(a.href);
    });

    document.getElementById('clear').addEventListener('click',()=>{
      if(confirm('¿Eliminar todos los bloques de esta semana?')){
        EVENTS = [];
        save();
        render();
      }
    });

    // Inicializar
    render();
  </script>
</body>
</html>
